/*
 * OpenAPI Petstore
 *
 * This is a sample server Petstore server. For this sample, you can use the api key `special-key` to test the authorization filters.
 *
 * API version: 1.0.0
 * Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package main

import (
	"embed"
	"io/fs"
	"log"
	"net/http"

	openapi "github.com/danicc097/openapi-go-gin-postgres-sqlc/internal/go"
	"github.com/gin-gonic/gin"
)

//go:embed swagger-ui
var content embed.FS

func main() {
	log.Printf("Server started")

	router := openapi.NewRouter()

	// TODO defining static file serving in spec
	fsys, _ := fs.Sub(content, "swagger-ui")
	router.StaticFS("/v2/docs", http.FS(fsys))

	oas, err := content.ReadFile("swagger-ui/openapi.yaml")
	if err != nil {
		panic("openapi spec not found")
	}
	// TODO defining static file serving in spec
	router.GET("/v2/openapi.yaml", func(c *gin.Context) { c.String(http.StatusOK, string(oas)) })
	log.Fatal(router.Run(":8090"))
}
